<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alethea Studio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"><i class="fas fa-layer-group"></i> Alethea</a>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="nav nav-pills ms-auto" id="mainTab" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" id="simulation-tab" data-bs-toggle="tab" data-bs-target="#simulation" type="button">
                        <i class="fas fa-play-circle"></i> Simulation
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="workbench-tab" data-bs-toggle="tab" data-bs-target="#workbench" type="button">
                        <i class="fas fa-tools"></i> Workbench
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="chronicles-tab" data-bs-toggle="tab" data-bs-target="#chronicles" type="button">
                        <i class="fas fa-book-open"></i> Chronicles
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid mt-3 tab-content" id="mainTabContent">
    
    <div class="tab-pane fade show active" id="simulation" role="tabpanel">
        <div class="row">
            <div class="col-12 mb-3 bg-white p-2 border-bottom shadow-sm">
                <div class="d-flex align-items-center gap-3 flex-wrap">
                    <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#simSettingsPanel">
                        <i class="fas fa-cog"></i>
                    </button>

                    <button id="btn-build-world" class="btn btn-primary btn-sm">
                        <i class="fas fa-hammer"></i> Build
                    </button>

                    <div class="vr"></div>

                    <label class="small">Epochs: 
                        <input type="number" id="sim-epochs" value="30" class="form-control form-control-sm d-inline-block" style="width:70px">
                    </label>

                    <button id="btn-run-sim" class="btn btn-success btn-sm">
                        <i class="fas fa-play"></i> Run
                    </button>

                    <span id="sim-status" class="badge bg-secondary ms-auto">Idle</span>
                </div>
                
                <div class="collapse mt-2" id="simSettingsPanel">
                    <div class="card card-body bg-light p-2">
                        <div class="row g-2 align-items-center">
                            <div class="col-auto">
                                <span class="small fw-bold">Size:</span>
                            </div>
                            <div class="col-auto">
                                <input type="number" id="map-width" class="form-control form-control-sm" placeholder="W" value="7" style="width: 60px;">
                            </div>
                            <div class="col-auto">
                                <input type="number" id="map-height" class="form-control form-control-sm" placeholder="H" value="5" style="width: 60px;">
                            </div>
                            <div class="col-auto ms-3">
                                <span class="small fw-bold">Biomes:</span>
                            </div>
                            <div class="col" id="biome-selector-container">
                                <span class="small text-muted">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center py-1">
                        <span class="small"><i class="fas fa-map"></i> World Map (Live)</span>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-light" id="btn-zoom-in"><i class="fas fa-plus"></i></button>
                            <button class="btn btn-outline-light" id="btn-zoom-reset"><i class="fas fa-compress"></i></button>
                            <button class="btn btn-outline-light" id="btn-zoom-out"><i class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <div class="card-body p-0 d-flex justify-content-center bg-secondary position-relative" style="height: 70vh; overflow: hidden; background: #2b2b2b !important;">
                        <canvas id="world-map-canvas" style="display: block; cursor: grab;"></canvas>
                        
                        <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-dark bg-opacity-75 text-white d-flex align-items-center gap-2">
                             <span class="small">Age: <span id="lbl-age">0</span></span>
                             <input type="range" class="form-range flex-grow-1" id="time-slider" min="0" max="0" value="0" disabled>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header py-1 small fw-bold">Event Log</div>
                    <div class="card-body p-0 bg-light">
                        <div id="sim-logs" class="p-2" style="height: 70vh; overflow-y: auto; font-family: monospace; font-size: 0.8rem;">
                            <div class="text-muted text-center mt-3">Click "Build", then "Run"...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="workbench" role="tabpanel">
        <div class="row h-100">
            <div class="col-md-2 border-end">
                <h6 class="text-muted uppercase">Templates</h6>
                <div class="list-group" id="config-list">
                    </div>
            </div>
            <div class="col-md-7">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 id="editor-title">Select Template</h5>
                    <button id="btn-save-template" class="btn btn-success btn-sm" disabled>
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
                <div id="json-editor-holder"></div>
            </div>
            <div class="col-md-3 bg-light p-3 border-start">
                <h6><i class="fas fa-magic text-warning"></i> AI Copilot</h6>
                <p class="small text-muted">Describe what you want to add, and AI will generate the JSON.</p>
                <textarea id="ai-prompt" class="form-control mb-2" rows="4" placeholder="Example: Aggressive cannibal elves living in swamps..."></textarea>
                <button id="btn-ai-generate" class="btn btn-primary w-100">
                    <i class="fas fa-sparkles"></i> Generate
                </button>
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="chronicles" role="tabpanel">
        <div class="row h-100">
            <div class="col-md-8 position-relative">
                <div id="cy" style="width: 100%; height: 85vh; background: #f0f2f5;"></div>
                
                <div class="position-absolute bottom-0 start-50 translate-middle-x mb-3 w-50 p-2 bg-white rounded shadow text-center">
                    <label>Epoch: <span id="chrono-age-display">0</span></label>
                    <input type="range" id="chrono-slider" class="form-range" min="0" max="100" value="0">
                </div>
            </div>

            <div class="col-md-4 border-start bg-white" style="height: 85vh; overflow-y: auto;">
                <div class="p-3">
                    <ul class="nav nav-tabs" id="infoTabs">
                        <li class="nav-item"><a class="nav-link active" href="#info-details" data-bs-toggle="tab">Info</a></li>
                        <li class="nav-item"><a class="nav-link" href="#info-story" data-bs-toggle="tab">Chronicle</a></li>
                    </ul>
                    
                    <div class="tab-content mt-3">
                        <div class="tab-pane fade show active" id="info-details">
                            <p class="text-muted text-center mt-5">Select an object on the graph</p>
                        </div>
                        
                        <div class="tab-pane fade" id="info-story">
                            <div class="mb-3">
                                <label class="form-label small">Setting</label>
                                <input type="text" class="form-control form-control-sm" id="story-setting" value="Dark Fantasy">
                            </div>
                            <button id="btn-narrate-history" class="btn btn-outline-primary btn-sm w-100 mb-3">
                                <i class="fas fa-feather-alt"></i> Narrate Epoch
                            </button>
                            <div id="story-output" class="markdown-body"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>
<script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script type="module" src="static/js/app.js"></script>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header bg-success text-white">
      <strong class="me-auto"><i class="fas fa-check-circle"></i> Simulation</strong>
      <small>Just now</small>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      Simulation completed! History loaded.
    </div>
  </div>
</div>

</body>
</html>